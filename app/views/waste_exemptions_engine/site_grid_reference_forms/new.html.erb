<% if WasteExemptionsEngine.configuration.host_is_back_office? %>
  <%= render("waste_exemptions_engine/shared/back", 
            token: @site_grid_reference_form.token,
            back_path: operation_sites_forms_path(@site_grid_reference_form.token, page: @page)) %>
<% else %>
  <%= render("waste_exemptions_engine/shared/back", token: @site_grid_reference_form.token) %>
<% end %>

<% is_multisite = @site_grid_reference_form.transient_registration.multisite? %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <% form_options = {} %>
    <% form_options[:url] = @form_url if defined?(@form_url) && @form_url.present? %>
    <% form_options[:method] = @form_method if defined?(@form_method) && @form_method.present? %>
    <%= form_for @site_grid_reference_form, form_options do |f| %>
      <%= render partial: "waste_exemptions_engine/shared/error_summary", locals: { f: f } %>

      <h1 class="govuk-heading-l">
        <%= t(".heading") %>
      </h1>

      <p class="govuk-body">
        <%= t(".grid_reference_preferred_option") %>
        <% if is_multisite %>
          <br>
          <%= t(".multisite_instruction") %>
        <% end %>
      </p>

      <% if !defined?(@allow_skip_to_postcode) || @allow_skip_to_postcode %>
        <p class="govuk-body">
          <%= t(".postcode_prefix") %> <%= link_to(t(".postcode_link_text"), skip_to_address_site_grid_reference_forms_path(@site_grid_reference_form.token)) %>
        </p>
      <% end %>

      <p class="govuk-body"><%= t(".or") %></p>

      <% grid_ref_finder_link = link_to(t(".grid_reference_help_tool_link"), "http://gridreferencefinder.com/", rel: "external", target: "_blank") %>

      <p class="govuk-body">
        <%= t(".grid_reference_link_hint", grid_ref_finder_link:).html_safe %>
      </p>

      <%= f.govuk_text_field :grid_reference,
        label: {
          text: t(".grid_reference_label")
        },
        width: "one-third",
        hint: {
          text: t(".grid_reference_hint")
        }
      %>

      <% if defined?(@page) && @page.present? %>
        <%= hidden_field_tag :page, @page %>
      <% end %>

      <%= f.govuk_text_area :description,
        label: {
          text: t(".description_label"),
          size: "s"
        },
        hint: {
          text: t(".description_hint")
        },
        max_chars: 500
      %>

      <% if is_multisite %>
        <p class="govuk-body" style="color: #d4351c;">
          <%= t(".continue_instruction") %>
        </p>
      <% end %>

      <% if WasteExemptionsEngine.configuration.host_is_back_office? && !is_multisite %>
        <%= f.govuk_check_box :is_linear,
          1,
          0,
          multiple: false,
          link_errors: true,
          label: { text: t(".mark_as_linear") } %>
        <br>
      <% end %>

      <%= f.govuk_submit t(".next_button") %>
    <% end %>
  </div>
</div>
